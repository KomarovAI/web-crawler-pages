name: Scrape Website
on:
  workflow_dispatch:
jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Scrape callmedley.com
        run: |
          mkdir -p sites/callmedley_com/pages
          wget -r -l 3 -k -p --no-parent --timeout=10 -q \
            -P sites/callmedley_com/ \
            https://callmedley.com/ 2>&1 || echo "wget completed with exit code $?"
      - name: Find and list files
        run: |
          find sites/callmedley_com -type f -name '*.html' | sort > /tmp/all_files.txt
          echo "Total HTML files: $(wc -l < /tmp/all_files.txt)"
      - name: Process pages
        run: python3 process_pages.py
      - name: Commit scraped content
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add sites/callmedley_com/ || true
          git commit -m "ðŸ•·ï¸ Scraped website" || true
          git push origin main || echo "Nothing to push"
