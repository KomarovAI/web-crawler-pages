{
  "name": "My workflow - FIXED",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "github-archive",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [-176, -256],
      "id": "ed0c8cc6-9fc2-4515-92f1-ce69b86ec916",
      "name": "Webhook",
      "webhookId": "fa4dfee7-0a0a-41eb-b32c-1780d49b482c"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Webhook\nconst webhookInput = $input.first().json;\n\n// –í–ê–ñ–ù–û: –¥–∞–Ω–Ω—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ body, –Ω–µ –≤ –∫–æ—Ä–Ω–µ!\nconst input = webhookInput.body || webhookInput;\n\nconsole.log(\"üì• INPUT received:\", JSON.stringify(input, null, 2));\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã\nconst url = input.url || \"\";\nconst maxPages = input.max_pages || input.maxPages || \"500\";\nconst useSelenium = input.use_selenium || input.useSelenium || \"true\";\nconst ignoreRobots = input.ignore_robots || input.ignoreRobots || \"false\";\nconst targetRepo = input.target_repo || input.targetRepo || \"KomarovAI/web-crawler-pages\";\nconst autoDeploy = input.auto_deploy || input.autoDeploy || \"true\";\nconst reuseArtifactRunId = input.reuse_artifact_run_id || input.reuseArtifactRunId || \"\";\n\nconsole.log(\"üîç Parsed inputs:\");\nconsole.log(`  URL: ${url}`);\nconsole.log(`  Max Pages: ${maxPages}`);\nconsole.log(`  Use Selenium: ${useSelenium}`);\nconsole.log(`  Ignore Robots: ${ignoreRobots}`);\nconsole.log(`  Target Repo: ${targetRepo}`);\nconsole.log(`  Auto Deploy: ${autoDeploy}`);\n\n// ‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø 1: URL –ø—Ä–æ–≤–µ—Ä–∫–∞\nif (!url || !/^https?:\\/\\//.test(url)) {\n  throw new Error(`‚ùå INVALID URL: \"${url}\" - must start with http:// or https://`);\n}\n\nconsole.log(\"‚úÖ URL validation PASSED\");\n\n// ‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø 2: max_pages –ø—Ä–æ–≤–µ—Ä–∫–∞\nconst maxPagesNum = parseInt(maxPages, 10);\nif (isNaN(maxPagesNum) || maxPagesNum < 1 || maxPagesNum > 5000) {\n  throw new Error(`‚ùå INVALID MAX_PAGES: \"${maxPages}\" - must be 1-5000`);\n}\n\nconsole.log(\"‚úÖ Max pages validation PASSED\");\n\n// ‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø 3: target_repo –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞\nif (!targetRepo.match(/^[\\w\\-]+\\/[\\w\\-]+$/)) {\n  throw new Error(`‚ùå INVALID TARGET_REPO: \"${targetRepo}\" - format must be owner/repo`);\n}\n\nconsole.log(\"‚úÖ Target repo validation PASSED\");\n\n// ‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø 4: Extract domain –∏–∑ URL (–ë–ï–ó –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ URL –∫–ª–∞—Å—Å–∞)\nlet domain = \"\";\ntry {\n  // –ò—Å–ø–æ–ª—å–∑—É–µ–º regex –≤–º–µ—Å—Ç–æ new URL()\n  domain = url\n    .replace(/^https?:\\/\\//, '')      // –£–¥–∞–ª—è–µ–º http:// –∏–ª–∏ https://\n    .split('/')[0]                     // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ–º–µ–Ω\n    .split('?')[0];                    // –£–¥–∞–ª—è–µ–º query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã\n  \n  if (!domain) {\n    throw new Error(\"Domain is empty\");\n  }\n  \n  console.log(`‚úÖ Domain extracted: ${domain}`);\n} catch (e) {\n  throw new Error(`‚ùå Failed to parse URL: ${e.message}`);\n}\n\nconsole.log(\"‚úÖ All validations PASSED!\");\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\nreturn {\n  url: url,\n  maxPages: String(maxPagesNum),\n  useSelenium: String(useSelenium === \"true\" || useSelenium === true),\n  ignoreRobots: String(ignoreRobots === \"true\" || ignoreRobots === true),\n  targetRepo: targetRepo,\n  autoDeploy: String(autoDeploy === \"true\" || autoDeploy === true),\n  reuseArtifactRunId: reuseArtifactRunId || \"\",\n  domain: domain,\n  validatedAt: new Date().toISOString(),\n  status: \"‚úÖ VALIDATION PASSED\"\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [32, -256],
      "id": "2b228cec-82d8-4110-87f7-3e88094b2790",
      "name": "—Ñ–æ—Ä–º–∏—Ä–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞"
    },
    {
      "parameters": {
        "resource": "workflow",
        "operation": "dispatchAndWait",
        "owner": {
          "__rl": true,
          "value": "KomarovAI",
          "mode": "name"
        },
        "repository": {
          "__rl": true,
          "value": "web-crawler",
          "mode": "name"
        },
        "workflowId": {
          "__rl": true,
          "value": "download-site.yml",
          "mode": "filename"
        },
        "ref": {
          "__rl": true,
          "value": "main",
          "mode": "name"
        },
        "inputs": "={\"url\": \"{{ $json.url }}\", \"max_pages\": \"{{ $json.maxPages }}\", \"use_selenium\": \"{{ $json.useSelenium }}\", \"ignore_robots\": \"{{ $json.ignoreRobots }}\"}"
      },
      "type": "n8n-nodes-base.github",
      "typeVersion": 1.1,
      "position": [240, -256],
      "id": "596923e6-af6a-4804-9aca-7f679d1de3ec",
      "name": "Dispatch a workflow event and wait for completion",
      "webhookId": "5ad01eab-8d74-416f-816c-0801c7cad0bb",
      "credentials": {
        "githubApi": {
          "id": "LxTwkRmqesV4PeVF",
          "name": "GitHub account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "—Ñ–æ—Ä–º–∏—Ä–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "—Ñ–æ—Ä–º–∏—Ä–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞": {
      "main": [
        [
          {
            "node": "Dispatch a workflow event and wait for completion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "f62ea467-3624-469f-8fb7-19406ebacbba",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "bc92d5239af63247dab79472db32c79b12ad3421f5a46f0229da6eba80d53a5b"
  },
  "id": "kKmepEIa36OnTWyv",
  "tags": []
}
